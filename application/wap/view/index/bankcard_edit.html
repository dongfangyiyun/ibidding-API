<!-- 新建html模板页 -->

{include file="/index/top" /}
</head>
<style type="text/css">
  .add-bank {
    text-align: center;
    width: 80%;
    margin: 2rem auto;
  }
</style>

<body>
  <div id="app">
    <!-- 头部 -->
    <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="background-image:none;">
      <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="background-image:none;">
        <a class="aui-pull-left aui-btn" onclick="goto('bankcard_list')">
          <span class="aui-iconfont aui-icon-left"></span>
        </a>
        <div class="aui-title" v-text="title"></div>
        <a v-if="isEdit" class="aui-pull-right aui-btn" @click="deleteCard">
          <span class="aui-iconfont iconfont icon-shanchu"></span>
        </a>
      </header>
    </header>
    <!-- 中间页 -->
    <div class="aui-content">
      <div class="add-bank-header">
        <!-- <div class="add-bank">
          <img src="__static__/wap/images/wancllshopidcard.png" class="backimg">
          <div class="aui-font-size-14 aui-text-info">点击拍照上传银行卡照片</div>
        </div> -->
        <div class="input aui-list aui-form-list">
          <div class="input-bank aui-list-item">
            <div class="aui-list-item-inner">
              <div class="aui-list-item-label">
                银行名称
              </div>
              <div class="aui-list-item-input">
                <select v-model="card.bank_name">
                  <option value="">请选择银行名称</option>
                  <option>中国农业银行</option>
                  <option>中国建设银行</option>
                  <option>中国工商银行</option>
                  <option>中国银行</option>
                  <option>招商银行</option>
                  <option>光大银行</option>
                  <option>中国邮政储蓄银行</option>
                  <option>兴业银行</option>
                  <option>中信银行</option>
                  <option>浦发银行</option>
                  <option>广发银行</option>
                  <option>平安银行</option>
                  <option>交通银行</option>
                  <option>华夏银行</option>
                  <option>民生银行</option>
                </select>
              </div>
            </div>
          </div>
          <div class="input-bank aui-list-item">
            <div class="aui-list-item-inner">
              <div class="aui-list-item-label">
                持卡人
              </div>
              <div class="aui-list-item-input">
                <input type="text" placeholder="请输入持卡人姓名" v-model="card.card_holder">
              </div>
            </div>
          </div>
          <div class="input-bank aui-list-item">
            <div class="aui-list-item-inner">
              <div class="aui-list-item-label">
                卡号
              </div>
              <div class="aui-list-item-input">
                <input type="text" placeholder="请输入卡号" v-model="card.card_number">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="aui-btn aui-btn-info aui-btn-block" style="width: 80%; margin: 1rem auto" @click="submit">确认</div>
  </div>
  </div>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        title: querystring.cardId ? '编辑银行卡' : '新增银行卡',
        isEdit: querystring.cardId ? true : false,
        card: {
          bank_name: '',
          card_number: '',
          card_holder: ''
        }
      },
      methods: {
        submit: function () {
          if (!this.card.bank_name) {
            layer.msg('请选择银行')
            return;
          }
          if (!this.card.card_number) {
            layer.msg('请填写银行卡号');
            return;
          }
          if (!this.card.card_holder) {
            layer.msg('请填写持卡人');
            return;
          }

          var router = querystring.cardId ? 'api_users/bank_cards/update' : 'api_users/bank_cards/save';
          httpRequest('POST', router, this.card)
            .then(function (resp) {
              layer.msg(resp.msg);
              setTimeout(() => {
                goto('bankcard_list')
              }, 500);
            })
        },
        deleteCard: function () {
          layer.alert('确定删除银行卡?', function (index) {
            layer.close(index)
            httpRequest('POST', 'api_users/bank_cards/delete', { id: querystring.cardId })
              .then(function (resp) {
                layer.msg(resp.msg);
                setTimeout(() => {
                  goto('bankcard_list')
                }, 500);
              })
          })
        },
        fileClick: function () {
          document.getElementById('upload_file').click()
        },
        //文件发生该变
        fileChange: function (el) {
          if (!el.target.files[0].size) return;
          this.fileList(el.target);
          el.target.value = ''
        },
        //文件列表
        fileList: function (fileList) {
          var files = fileList.files;
          for (var i = 0; i < files.length; i++) {
            //判断是否为文件夹
            if (files[i].type != '') {
              this.fileAdd(files[i]);
            } else {
              //文件夹处理
              this.folders(fileList.items[i]);
            }
          }
        },
        //文件夹处理
        folders: function (files) {
          var _this = this;
          //判断是否为原生file
          if (files.kind) {
            files = files.webkitGetAsEntry();
          }
          files.createReader().readEntries(function (file) {
            for (var i = 0; i < file.length; i++) {
              if (file[i].isFile) {
                _this.foldersAdd(file[i]);
              } else {
                _this.folders(file[i]);
              }
            }
          })
        },
        foldersAdd: function (entry) {
          var _this = this;
          entry.file(function (file) {
            _this.fileAdd(file)
          })
        },
        fileAdd: function (file) {
          //判断是否为图片文件
          if (file.type.indexOf('image') == -1) {
            layer.msg('请选择图片类型的文件')
          } else {
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
              file.src = this.result;

            }
          }
        },
      },
      computed: {

      },
      filters: {

      },
      mounted: function () {
        if (querystring.cardId) {
          httpRequest('POST', 'api_users/bank_cards/read', { id: querystring.cardId })
            .then(function (resp) {
              app.card = resp.data;
            })
        }
      }
    })
  </script>
</body>

</html>
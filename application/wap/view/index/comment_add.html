<!-- 新建html模板页 -->

{include file="/index/top" /}
<style>
  .goods {
    display: flex;
    align-items: center;
    background-color: #fff;
  }

  .goods .thum {
    width: 25%;
    padding: 0.5rem 0.5rem;
  }

  .goods .thum img {
    width: 100%;
    border: 1px solid #f4f4f4;
  }

  .goods .content {
    width: 75%;
    padding: 0.5rem 0.5rem 0rem 0rem;
  }

  .goods .content textarea {
    height: 5rem;
    font-size: 0.7rem;
  }

  .comment {
    padding: 1rem 0.7rem;
    background-color: #fff;
  }

  .comment .imgs {
    width: 100%;
  }

  .comment .imgs img {
    max-width: 24%;
    display: inline-block;
  }

  .comment .imgs .photo {
    border: 1px solid #f4f4f4;
  }

  .comment .star {
    margin-top: 1rem;
    align-items: center;
  }

  .comment .star .text {
    color: #999999;
    padding-right: 1.5rem;
    display: inline-block;
    line-height: 1.5rem;
    height: 1.5rem;
    vertical-align: top;
  }

  .comment .star .stars {
    display: inline-block;
  }
</style>
</head>

<body>
  <div id="app">
    <!-- 头部 -->
    <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="background-image:none;">
      <a class="aui-pull-left aui-btn" onclick="javascript:window.history.back(); return false;">
        <span class="aui-iconfont aui-icon-left"></span>
      </a>
      <div class="aui-title" v-text="title"></div>
    </header>
    <!-- 中间页 -->
    <div class="aui-content">
      <div class="goods">
        <div class="thum">
          <img :src="goods.thum">
        </div>
        <div class="content">
          <textarea class="aui-padded-5 aui-border" rows="8" cols="80" placeholder="商品满足您的期待吗？说说你的体验，分享给 想买的TA们吧" v-model="message"></textarea>
        </div>
      </div>
      <div class="comment">
        <div class="imgs" id="imgs">
          <img :src="img" class="photo" v-for="(img,key) in imgs" :key="key">
          <img src="__static__/wap/images/add_photo.png" @click="fileClick()">
          <input @change="fileChange($event)" type="file" id="upload_file" style="display: none" multiple>
        </div>
        <div class="star">
          <div class="text">发表评价</div>
          <div class="stars">
            <i class="aui-iconfont iconfont icon-shoucang aui-margin-5" v-for="(item,key) in [1,2,3,4,5]" :key="key" style="font-size: 1.2rem;"
              @click="star(key + 1)" :style="{color: ((key + 1) <= starLevel ? '#ffc640' : '#ccc')}"></i>
          </div>
        </div>
      </div>
      <div class="area">
        <div class="submit" @click="submit()">发表评价</div>
      </div>

    </div>
  </div>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        title: '发表评论',
        goods: getStorage('goods', sessionStorage),
        message: '',
        imgs: [],
        starLevel: 0,
      },
      methods: {
        star: function (level) {
          this.starLevel = level;
        },
        submit: function () {
          if (!this.starLevel) {
            layer.msg('请选择星级');
            return;
          }
          if (!this.message) {
            layer.msg('请输入评论内容');
            return;
          }
          httpRequest('POST', 'api_goods/goods_comments/save', {
            order_id: querystring.orderId,
            goods_id: this.goods.goods_id,
            score: this.starLevel,
            content: this.message,
            imgs: this.imgs,
            status: 1,
          }).then(function (resp) {
            layer.msg(resp.msg);
            setTimeout(function () {
              goto('order_list');
            }, 500);
          })
        },
        fileClick: function () {
          document.getElementById('upload_file').click()
        },
        //文件发生该变
        fileChange: function (el) {
          if (!el.target.files[0].size) return;
          this.fileList(el.target);
          el.target.value = ''
        },
        //文件列表
        fileList: function (fileList) {
          var files = fileList.files;
          for (var i = 0; i < files.length; i++) {
            //判断是否为文件夹
            if (files[i].type != '') {
              this.fileAdd(files[i]);
            } else {
              //文件夹处理
              this.folders(fileList.items[i]);
            }
          }
        },
        //文件夹处理
        folders: function (files) {
          var _this = this;
          //判断是否为原生file
          if (files.kind) {
            files = files.webkitGetAsEntry();
          }
          files.createReader().readEntries(function (file) {
            for (var i = 0; i < file.length; i++) {
              if (file[i].isFile) {
                _this.foldersAdd(file[i]);
              } else {
                _this.folders(file[i]);
              }
            }
          })
        },
        foldersAdd: function (entry) {
          var _this = this;
          entry.file(function (file) {
            _this.fileAdd(file)
          })
        },
        fileAdd: function (file) {
          //判断是否为图片文件
          if (file.type.indexOf('image') == -1) {
            layer.msg('请选择图片类型的文件')
          } else {
            var that = this;
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
              if (that.imgs.length < 5) {
                file.src = this.result;
                that.imgs.push(file.src)
              } else {
                layer.msg('最多上传5张图片')
              }
            }
          }
        },
      },
      computed: {

      },
      mounted: function () {

      }
    })
  </script>
</body>

</html>